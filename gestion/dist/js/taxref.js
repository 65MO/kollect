function calcimportchange(e,a,t){"use strict";var s=0;progessbar=document.getElementById("BarFiche"),progessbar.value=s,progessbar.max=e,$("#BarFiche").show(),traitementchange(e,s,a,t)}function calcimportsuivchange(e,a,t,s,r){"use strict";if(a+t==e)progessbar.value=e,$("#BarFiche").hide(),$("#mes").html('<div class="alert alert-success" role="alert">'+e+" lignes ont été importées. Construction de la table stockant les changements de nom (cdref)</div>"),histo();else{var n=r;progessbar.value=a,a+=t,traitementchange(e,a,n,s)}}function traitementchange(e,a,t,s){"use strict";$.ajax({url:"modeles/ajax/taxref/change.php",type:"POST",dataType:"json",data:{nbdeb:t,fichier:s},success:function(t){"Oui"==t.statut&&calcimportsuivchange(e,a,t.nb,s,t.derniere)}})}function histo(){"use strict";$.ajax({url:"modeles/ajax/taxref/version.php",type:"POST",dataType:"json",success:function(e){"Oui"==e.statut?$("#mes").append('<div class="alert alert-success" role="alert">'+e.nb+" lignes ont été insérées dans la table. (Il y a "+e.nb+" chancgements de nom)</div>"):alert("problème dans la requête")}})}function calcimporttaxref(e,a,t){"use strict";var s=0;progessbar=document.getElementById("BarFiche1"),progessbar.value=s,progessbar.max=e,$("#BarFiche1").show(),traitementtaxref(e,s,a,t)}function calcimportsuivtaxref(e,a,t,s,r){"use strict";if(a+t==e)progessbar.value=e,$("#BarFiche1").hide(),$("#mes1").html('<div class="alert alert-success" role="alert">'+e+" lignes ont été importées dans la table taxref. Votre table est maintenant à jour</div>");else{var n=r;progessbar.value=a,a+=t,traitementtaxref(e,a,n,s)}}function traitementtaxref(e,a,t,s){"use strict";$.ajax({url:"modeles/ajax/taxref/taxref.php",type:"POST",dataType:"json",data:{nbdeb:t,fichier:s},success:function(t){"Oui"==t.statut&&calcimportsuivtaxref(e,a,t.nb,s,t.derniere)}})}function version(){var e=$("#version").val();$.ajax({url:"modeles/ajax/taxref/mjversion.php",type:"POST",dataType:"json",data:{version:e},success:function(e){"Oui"==e.statut?($("#valajax").html(""),$("#verif").show()):alert("Erreur durant l'enregistrement du fichier json")}})}var maxbar,progessbar;$(document).ready(function(){"use strict";$("#BarFiche").hide(),$("#BarFiche1").hide(),$("#verif").hide()}),$("#change").click(function(){"use strict";$("#mes").html("");var e=$("#version").val();$.ajax({url:"modeles/ajax/taxref/changedeb.php",type:"POST",dataType:"json",data:{version:e},success:function(e){if("Oui"==e.statut){var a=0;$("#mes").html(e.nb+" lignes dans le fichier. Import des données en cours."),calcimportchange(e.nb,a,e.nomfichier)}else $("#mes").html(e.mes)}})}),$("#taxref").click(function(){"use strict";$("#mes").html(""),$("#mes1").html("");var e=$("#version").val();$.ajax({url:"modeles/ajax/taxref/taxrefdeb.php",type:"POST",dataType:"json",data:{version:e},success:function(e){if("Oui"==e.statut){var a=0;$("#mes1").html(e.nb+" lignes dans le fichier. Import des données en cours."),calcimporttaxref(e.nb,a,e.nomfichier)}else $("#mes1").html(e.mes)}})}),$("#maj").click(function(){"use strict";$("#valajax").html("<progress></progress>"),$.ajax({url:"modeles/ajax/taxref/misejour.php",type:"POST",dataType:"json",success:function(e){"Oui"==e.statut?version():alert("Erreur durant le traitement")}})});