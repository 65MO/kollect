function exporter(e){"use strict";var t=$("#choix option:selected").val();$("#valajax").show(),$.ajax({url:"modeles/ajax/observatoire/exportsyst.php",type:"POST",dataType:"json",data:{sel:t,nomfr:e},success:function(a){if("Oui"==a.statut){$("#valajax").hide();var s=JSON2CSV(a.taxon);"non"==e?(downloadFile("liste-"+t+".csv","data:text/csv;charset=UTF-8,"+encodeURIComponent(s)),$("#mes").html('<div class="alert alert-success" role="alert">Le fichier liste-'+t+" a été exporté</div>")):(downloadFile("liste-"+t+"fr.csv","data:text/csv;charset=UTF-8,\ufeff"+encodeURIComponent(s)),$("#mes").html('<div class="alert alert-success" role="alert">Le fichier liste-'+t+"fr.csv a été exporté</div>"))}else $("#mes").html(a.mes),$("#valajax").hide()}})}function JSON2CSV(e){var t="object"!=typeof e?JSON.parse(e):e,a="",s="";t[0];for(var o in t[0])s+=o+";";s=s.slice(0,-1),a+=s+"\r\n";for(var i=0;i<t.length;i++){var s="";for(var o in t[i])s+=t[i][o]+";";s=s.slice(0,-1),a+=s+"\r\n"}return a}function downloadFile(e,t){var a=document.createElement("a");a.download=e,a.href=t;var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!1,document.defaultView,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(s)}$(document).ready(function(){"use strict";$("#valajax").hide(),$("#ok").hide(),$("#expli").hide()}),$("#choix").change(function(){"use strict";$("#mes").html(""),$("#ok").hide();var e=$("#choix option:selected").val();"NR"!=e?($("#valajax").show(),$.ajax({url:"modeles/ajax/observatoire/systema.php",type:"POST",dataType:"json",data:{sel:e,re:"groupe"},success:function(t){"Oui"==t.statut?($("#valajax").hide(),$("#mes").html(t.mes),$("#ok").show(),$("#expli").show(),$(".nimpo").html("liste-"+e+".csv ou liste-"+e+"fr.csv"),$("#sel").val(e),""!=t.gen1&&$("#gen1").val(t.gen1),""!=t.gen2&&$("#gen2").val(t.gen2)):($("#mes").html(t.mes),$("#ok").hide(),$("#expli").hide(),$("#valajax").hide())}})):$("#expli").hide()}),$("#BttVfr").click(function(){"use strict";var e="oui";exporter(e)}),$("#BttV").click(function(){"use strict";var e="non";exporter(e)}),$("#import").on("submit",function(e){"use strict";e.preventDefault();var t=$(this),a=window.FormData?new FormData(t[0]):null,s=null!==a?a:t.serialize();$("#valajax").show(),$.ajax({url:"modeles/ajax/observatoire/importliste.php",type:"POST",dataType:"json",data:s,contentType:!1,processData:!1,success:function(e){"Oui"==e.statut?($("#valajax").hide(),$("#mes").html('<div class="alert alert-success" role="alert">Les lignes ont bien été insérées en base de donnée.</div>'),$("html, body").animate({scrollTop:0},"slow")):($("#mes").html(e.mes),$("#valajax").hide())}})});