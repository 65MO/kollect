function carte(e){"use strict";proj4.defs("EPSG:2154","+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");var t=e.utm,o=(e.contour2,e.emprise),a=e.ne,r=e.sw,i=e.cleign,s=(e.clegoogle,a.split(",",2)),l=r.split(",",2),c=parseFloat(s[0]),n=parseFloat(s[1]),p=parseFloat(l[0]),u=parseFloat(l[1]),m=L.map("map").fitBounds([[p,u],[c,n]]),h=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),y=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}),g=L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; Openstreetmap France | &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),d=L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:16,attribution:'Map data: &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="http://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'});if(i)var T=L.tileLayer("https://wxs.ign.fr/"+i+"/geoportail/wmts?LAYER=GEOGRAPHICALGRIDSYSTEMS.MAPS&EXCEPTIONS=text/xml&FORMAT=image/jpeg&SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetTile&STYLE=normal&TILEMATRIXSET=PM&&TILEMATRIX={z}&TILECOL={x}&TILEROW={y}",{attribution:'&copy; <a href=http://www.ign.fr/">IGN</a>'}),S=L.tileLayer("https://wxs.ign.fr/"+i+"/geoportail/wmts?LAYER=ORTHOIMAGERY.ORTHOPHOTOS&EXCEPTIONS=text/xml&FORMAT=image/jpeg&SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetTile&STYLE=normal&TILEMATRIXSET=PM&&TILEMATRIX={z}&TILECOL={x}&TILEROW={y}",{attribution:'&copy; <a href="http://www.ign.fr/">IGN</a>'}),E=L.tileLayer("https://wxs.ign.fr/"+i+"/geoportail/wmts?LAYER=CADASTRALPARCELS.PARCELS&EXCEPTIONS=text/xml&FORMAT=image/png&SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetTile&STYLE=normal&TILEMATRIXSET=PM&&TILEMATRIX={z}&TILECOL={x}&TILEROW={y}",{opacity:"0.5",attribution:'&copy; <a href="http://www.ign.fr/">IGN</a>'}),f={"Carte Open Street":y,"Carte Open Street FR":g,"Carte Open Topo":d,"Carte IGN":T,"Photo aériennes IGN":S,"Photo aériennes ESRI":h},O={Cadastre:E};else var f={"Carte Open Street":y,"Carte Open Street FR":g,"Carte Open Topo":d,"Photo aériennes ESRI":h},O={};if(e.couche){var v="osm"==e.couche?y:"osmfr"==e.couche?g:"topo"==e.couche?d:"ign"==e.couche?T:S;v.addTo(m)}else y.addTo(m);var w=L.control.layers(f,O);"fr"!=o?($.getJSON("../emprise/contour2.geojson",{},function(t){var o={color:e.stylecontour2.color,weight:e.stylecontour2.weight};L.Proj.geoJson(t,{style:o}).addTo(m)}),$.getJSON("../emprise/contour.geojson",{},function(t){var o={color:e.stylecontour.color,weight:e.stylecontour.weight},a=L.Proj.geoJson(t,{style:o}),r="Commune";w.addOverlay(a,r)}),"oui"==t?$.getJSON("modeles/ajax/site/mgrs.php",{},function(t){if("Oui"==t.statut){var o={color:e.stylemaille.color,weight:e.stylemaille.weight,opacity:e.stylemaille.opacity},a=L.Proj.geoJson(t.carto,{style:o,onEachFeature:function(e,t){t.bindPopup(e.properties.id)}}),r="Maille UTM/MGRS";w.addOverlay(a,r)}}):$.getJSON("modeles/ajax/site/maille93.php",{},function(t){if("Oui"==t.statut){var o={color:e.stylemaille.color,weight:e.stylemaille.weight,fillOpacity:e.stylemaille.opacity},a=L.Proj.geoJson(t.carto,{style:o,onEachFeature:function(e,t){t.bindPopup(e.properties.id)}}),r="MailleL93";w.addOverlay(a,r)}})):($.getJSON("../emprise/contour.geojson",{},function(t){var o={color:e.stylecontour.color,weight:e.stylecontour.weight};contour=L.Proj.geoJson(t,{style:o});var a="Départements";w.addOverlay(contour,a)}),"oui"==t&&$.getJSON("modeles/ajax/site/mgrs.php",{},function(t){if("Oui"==t.statut){var o={color:e.stylemaille.color,weight:e.stylemaille.weight,opacity:e.stylemaille.opacity},a=L.Proj.geoJson(t.carto,{style:o,onEachFeature:function(e,t){t.bindPopup(e.properties.id)}}),r="Maille UTM/MGRS";w.addOverlay(a,r)}})),L.control.scale({position:"bottomleft",metric:!0,imperial:!1}).addTo(m),w.addTo(m)}$(document).ready(function(){"use strict";$("#ajout").hide();var e={};$.ajax({url:"../emprise/emprise.json",dataType:"json",success:function(t){e=t,carte(e)}})}),$("#BttV").click(function(){"use strict";var e=$("#ign").val(),t=$("#emp").val(),o=$("#couche").val(),a=$("#proche").val(),r=$("#l935").val(),i=$("#color").val(),s=$("#weight").val(),l=$("#opacity").val(),c=$("#colorm").val(),n=$("#weightm").val(),p=$("#opacitym").val();if("fr"!=t)var u=$("#color2").val(),m=$("#weight2").val();else var u="",m="";$.ajax({url:"modeles/ajax/site/carto.php",type:"POST",dataType:"json",data:{ign:e,color:i,weight:s,opacity:l,colorm:c,weightm:n,opacitym:p,color2:u,weight2:m,couche:o,proche:a,l935:r},success:function(e){"Oui"==e.statut?location.reload():($("#mes").html(e.mes),$("#valajax").hide())}})}),$("#BttA").click(function(){"use strict";$("#ajout").show()}),$("#type").change(function(){"use strict";var e=$("#type").val();"choro"==e?$("#uni").prop("disabled",!1):$("#uni").prop("disabled",!0)}),$("#BttC").click(function(){"use strict";var e=$("#titre").val(),t=$("#stitre").val(),o=$("#type").val(),a=$("#uni").val();$.ajax({url:"modeles/ajax/site/couche.php",type:"POST",dataType:"json",data:{titre:e,stitre:t,type:o,uni:a},success:function(e){"Oui"==e.statut?$("#mescouche").html('<div class="alert alert-success">La définition de la couche est bien enregistré dans votre fichier emprise. Votre couche doit se nommer <b>couche'+e.nb+".geojson</b> et déposé dans le dossier emprise</div>"):$("#mescouche").html(e.mes)}})});