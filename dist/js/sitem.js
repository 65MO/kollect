function trouve(e,t){"use strict";$("#idgarde").val(""),$("#idsup").val(""),$("#mes").html(""),$.ajax({url:"modeles/ajax/membre/recupsite.php",type:"POST",dataType:"json",data:{site:e,codecom:t,idobser:idobser},success:function(e){"Oui"==e.statut?e.affiche?$("#result").html("Pas de doublons détectés pour ce site"):$("#result").html(e.liste):alert("problème ! pour récupérer les informations")}})}function centrersite(e,t,s){"use strict";var a=e.split(",",2),r=parseFloat(a[0]),i=parseFloat(a[1]);if("oui"==nbmap){nbmap="non",map=new L.map("mapdetail");var o=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});map.addLayer(o),map.setView([r,i],t),marker=L.marker([r,i]).addTo(map),""!=s&&(s=JSON.parse(s),contoursite=L.geoJson(s,{style:{color:"#03F",fillOpacity:.1,weight:3}}),contoursite.addTo(map))}else marker.setLatLng([r,i]),contoursite&&map.removeLayer(contoursite),""!=s&&(s=JSON.parse(s),contoursite=L.geoJson(s,{style:{color:"#03F",fillOpacity:.1,weight:3}}),contoursite.addTo(map))}var idobser=$("#idobser").val(),map,nbmap="oui",marker,contoursite;$(document).ready(function(){}),$("#choixsite").autocomplete({source:function(e,t){$.getJSON("modeles/ajax/membre/autosite.php",{term:e.term,idobser:idobser},function(e){t($.map(e,function(e){return{label:e.site+" ("+e.commune+")",value:e}}))})},select:function(e,t){this.value=t.item.label;var s=t.item.value;return trouve(s.site,s.codecom),!1}}),$("#result").on("click",".voirsite",function(){"use strict";var e=$(this).parent().parent().attr("id");$.ajax({url:"modeles/ajax/membre/siteleaflet.php",type:"POST",dataType:"json",data:{idsite:e},success:function(e){if("Oui"==e.statut){var t=e.site.lat+","+e.site.lng,s=16;centrersite(t,s,e.site.geo)}else alert("problème ! pour récupérer les informations")}})}),$("#result").on("click",".garde",function(){"use strict";var e=$(this).parent().parent().attr("id");$("#idgarde").val(e),$(".sup").addClass("text-danger"),$(".table").find("tr").removeClass("bg-success text-white"),$("#"+e).addClass("bg-success text-white"),$("#s"+e).removeClass("text-danger sup").addClass("text-success")}),$("#result").on("click",".sup",function(){"use strict";var e=$(this).parent().parent().attr("id"),t=$("#idsup").val();""!=t?$("#idsup").val(t+","+e):$("#idsup").val(e),$("#"+e).addClass("bg-danger text-white"),$("#g"+e).removeClass("text-success garde").addClass("text-danger")}),$("#result").on("click","#BttV",function(){var e=$("#idgarde").val(),t=$("#idsup").val();""==e||""==t?$("#mes").html('<p class="text-danger">Aucun site à garder ou à supprimer. Faites votre sélection au-dessus</p>'):($("#mes").html(""),$.ajax({url:"modeles/ajax/membre/siteval.php",type:"POST",dataType:"json",data:{idgarde:e,idsup:t},success:function(e){"Oui"==e.statut?($("#mes").html('<p class="text-success">Toutes les modifications ont été faites</p>'),$("#result").html(""),$("#choixsite").val("")):alert("problème ! pour attribuer les sites")}}))});