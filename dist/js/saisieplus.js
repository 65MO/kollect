function aide(){"use strict";$(this).hasClass("text-primary")?($('[data-toggle="tooltip"]').tooltip("enable",{title:"data-title"}),$(this).removeClass("text-primary").addClass("text-success")):($('[data-toggle="tooltip"]').tooltip("disable"),$(this).removeClass("text-success").addClass("text-primary"))}function choixobser(e){"use strict";$.ajax({url:"modeles/ajax/saisie/choixobser.php",type:"POST",dataType:"json",data:{sel:e},success:function(a){if("Oui"==a.statut){$("#blocsaisie").show(),$("#mes").html(""),$("#valsel").val("oui");var t;$.each(a.stade,function(e,a){t+="<option value="+a+">"+e+"</option>"}),$("#stade").html(t),t="",$.each(a.methode,function(e,a){t+="<option value="+a+">"+e+"</option>"}),$("#obsmethode").html(t),t="",$.each(a.collecte,function(e,a){t+="<option value="+a+">"+e+"</option>"}),$("#obscoll").html(t),t="",$.each(a.statutbio,function(e,a){t+="<option value="+a+">"+e+"</option>"}),$("#bio").html(t),t="",""!=a.mort?(t+="<option value=0>Choix</option>",$.each(a.mort,function(e,a){t+="<option value="+a+">"+e+"</option>"})):t+="<option value=0>Inconnu</option>",$("#mort").html(t),t="",$.each(a.protocole,function(e,a){t+="<option value="+a+">"+e+"</option>"}),$("#protocol").html(t),t="",$.each(a.obdenom,function(e,a){t+="<option value="+a+">"+e+"</option>"}),$("#tdenom").html(t),"mort"==a.stbio?($("#cmort").show(),$("#etatbio").html('<option value="3">Trouvé mort</option><option value="2">Observé vivant</option><option value="1">Non renseigné</option><option value="0">Inconu</option>')):($("#mort").val(0),$("#cmort").hide(),$("#etatbio").html('<option value="2">Observé vivant</option><option value="3">Trouvé mort</option><option value="1">Non renseigné</option><option value="0">Inconu</option>')),"oui"==a.locale?$("#imgpluslocale").show():($("#imgpluslocale").hide(),$("#pluslatin1").hide()),"oui"==a.aves?($("#aves").show(),$("#indnid").html(a.avesindice),$("#nicheur").html("")):($("#aves").hide(),$("#indnid option").remove(),$("#nicheur").html("")),"oui"==a.bota?($("#obscoll").prop("disabled",!0),$("#bio").prop("disabled",!0)):($("#obscoll").prop("disabled",!1),$("#bio").prop("disabled",!1)),"oui"==a.col?$("#imgpluscol").show():($("#imgpluscol").hide(),$("#pluscol").hide()),"oui"==a.plteh||"oui"==a.plteb?$("#plteh").show():$("#plteh").hide(),$("#sel").val(e),$("#nomb").val(""),$("#latin").val(""),$("#nomf").val(""),$("#cdnom").val(""),$("#cdref").val(""),$("#denom").val("Co"),$("#tdenom").val("IND"),$(".nbexact").prop("disabled",!1),$("#nbtmp").hide(),$("#estim").hide(),$("#nbmin").val(""),$("#nbmax").val(""),$("#validateur").val(a.validateur),a.mf&&($("#male").prop("disabled",!0),$("#femelle").prop("disabled",!0)),$("#"+a.aff).focus()}else $("#blocsaisie").hide(),$("#sel").val(e),$("#valsel").val("non"),$("#mes").html(a.mes),$("#stade option").remove(),$("#obsmethode option").remove(),$("#obscoll option").remove()}})}function cdref(e){$.ajax({url:"modeles/ajax/saisie/cdref.php",type:"POST",dataType:"json",data:{cdref:e,sel:sel},success:function(e){"Ok"==e.statut.Ok?$("#nomb").val(e.statut.Nom+" (nom valide)"):alert("pbm ! ajax cdref")},error:function(e){alert("Une erreure est survenue")}})}function mesvali(e,a,t,l,i){var s="",o=0;"Oui"==a?s+="Photo conseillée ":o+=1,"Oui"==t?s+="Son conseillé ":o+=1,"Oui"==l?s+="Examen en main ou avec loupe requis ":o+=1,"Oui"==i?s+="Examen sous binoculaire requis ":o+=1,4==o&&(s+="Validation manuelle"),s+="Tous"!=e?" pour le stade "+e+" de cette espèce.":" pour cette espèce.",$("#mesvali").html(s)}function valider(e){"use strict";var a=$("#pr").val(),t=$("#cdnom").val(),l=$("#protocol").val(),i=$("#etude").val(),s=$("#statutobs").val();"Nouv"==$("#idfiche").val()?a&&t?"No"==s&&0==l&&0==i?($("#valajaxs").hide(),$("#R1").html("<div class=\"alert alert-danger\">Il n'est pas possible d'enregistrer ce type d'observation. Une donnée d'absence doit-être liée à un protocole ou à une étude</div>")):verifeffectif(e,s):($("#BttV").show(),$("#BttN").show(),$("#valajaxs").hide(),$("#R1").html('<div class="alert alert-danger">Aucune localisation ou d\'espèce de saisie !</div>')):t?"No"==s&&0==l&&0==i?($("#valajaxs").hide(),$("#R1").html("<div class=\"alert alert-danger\">Il n'est pas possible d'enregistrer ce type d'observation. Une donnée d'absence doit-être liée à un protocole ou à une étude</div>")):verifeffectif(e,s):($("#BttV").show(),$("#BttN").show(),$("#valajaxs").hide(),$("#R1").html('<div class="alert alert-danger">Aucune espèce de saisie !</div>'))}function verifeffectif(e,a){var t=$("#denom").val(),l=$("#nbmin").val();"Pr"==a&&"NSP"!=t?""!=l?enregistrer(e):($("#BttV").show(),$("#BttN").show(),$("#valajaxs").hide(),$("#R1").html('<div class="alert alert-danger">Attention ! Aucun effectif de saisie. Cela peut arriver après avoir manipulé le champ "denombre." En retapant votre nombre cela devrait-être réglé</div>')):enregistrer(e)}function enregistrer(e){"use strict";var a=$("#communeb").val(),t=$("#lieub").val(),l=$("#xlambert").val(),i=$("#ylambert").val(),s=$("#altitude").val(),o=$("#l93").val(),n=$("#l935").val(),c=$("#lat").val(),d=$("#lng").val(),r=$("#idm").val(),u="oui"==utm?$("#utm").val():"",v="oui"==utm?$("#utm1").val():"",p=$("#stade option:selected").text(),m=$("#dep").val(),h=$("#nbmin").val(),b=$("#nbmax").val();$.ajax({url:"modeles/ajax/saisie/validation.php",type:"POST",dataType:"json",data:e.serialize()+"&dep="+m+"&com="+a+"&site="+t+"&x="+l+"&y="+i+"&alt="+s+"&l93="+o+"&l935="+n+"&lat="+c+"&lng="+d+"&utm="+u+"&utm1="+v+"&stadeval="+p+"&idm="+r+"&nbmin="+h+"&nbmax="+b,success:function(e){if("Oui"==e.statut){var a=$("#Bt").val();e.verifobs?$("#R1").html('<div class="alert alert-danger">Vous avez déjà saisie cette espèce pour cette fiche !</div>'):"Oui"==e.nouveau?("BttV"==a&&($("#listeobs").html(""),$("#BttV").show(),$("#R").html('<div class="alert alert-success"><i class="fa fa-check"></i> Donnée enregistrée<b> '+e.fiche.site+" - "+e.fiche.commune+" le "+e.fiche.date+"</b> - Vous pouvez enregistrer une nouvelle fiche</div>"),$("#R1").html(""),$("#idfiche").val("Nouv"),$("#idobs").val("Nouv"),efface("#formulaire"),affichefiche(),$("#observateur2").focus(),$("html, body").animate({scrollTop:0},"slow")),"BttS"==a&&($("#listeobs").html("<li>"+e.vali+" "+e.obs.nb+" "+e.obs.nom+" ("+e.obs.stade+")</li>"),$("#R1").html('<div class="alert alert-warning"><i class="fa fa-check"></i> Enregistrement en cours sur : <b> '+e.fiche.site+" - "+e.fiche.commune+" le "+e.fiche.date+"</b></div>"),$("#R").html(""),$("#idfiche").val(e.fiche.idfiche),$("#idobs").val(e.idobs),$("#nb").val(e.obs.nb),cache(),$("#stade").focus()),"BttN"==a&&($("#listeobs").html("<li>"+e.vali+" "+e.obs.nb+" "+e.obs.nom+" ("+e.obs.stade+")</li>"),$("#R1").html('<div class="alert alert-warning"><i class="fa fa-check"></i> Enregistrement en cours sur : <b> '+e.fiche.site+" - "+e.fiche.commune+" le "+e.fiche.date+"</b></div>"),$("#R").html(""),$("#idfiche").val(e.fiche.idfiche),$("#idobs").val("Nouv"),cache2(),$("#BttN").show())):("BttV"==a&&($("#listeobs").html(""),$("#BttV").show(),"oui"==$("#afiche").val()?$("#R").html('<div class="alert alert-success"><i class="fa fa-check"></i> Donnée ajoutée à la fiche n°<b> '+e.fiche.idfiche+"</b></div>"):$("#R").html('<div class="alert alert-success"><i class="fa fa-check"></i> Donnée enregistrée<b> '+e.fiche.site+" - "+e.fiche.commune+" le "+e.fiche.date+"</b> - Vous pouvez enregistrer une nouvelle fiche</div>"),$("#R1").html(""),$("#idfiche").val("Nouv"),$("#idobs").val("Nouv"),$("#afiche").val(""),efface("#formulaire"),affichefiche(),$("#observateur2").focus(),$("html, body").animate({scrollTop:0},"slow")),"BttS"==a&&(e.vali?$("#listeobs").prepend("<li>"+e.vali+" "+e.obs.nb+" "+e.obs.nom+" ("+e.obs.stade+")</li>"):$("#listeobs").prepend('<li><i class="fa fa-check text-success"></i> '+e.obs.nom+" ("+e.obs.stade+")</li>"),$("#R1").html('<div class="alert alert-warning"><i class="fa fa-check"></i> Enregistrement en cours sur : <b> '+e.fiche.site+" - "+e.fiche.commune+" le "+e.fiche.date+"</b></div>"),$("#R").html(""),$("#idfiche").val(e.fiche.idfiche),$("#idobs").val(e.idobs),$("#nb").val(e.obs.nb),cache(),$("#stade").focus()),"BttN"==a&&(e.vali?$("#listeobs").prepend("<li>"+e.vali+" "+e.obs.nb+" "+e.obs.nom+" ("+e.obs.stade+")</li>"):$("#listeobs").prepend('<li><i class="fa fa-check text-success"></i> '+e.obs.nom+" ("+e.obs.stade+")</li>"),$("#R1").html('<div class="alert alert-warning"><i class="fa fa-check"></i> Enregistrement en cours sur : <b> '+e.fiche.site+" - "+e.fiche.commune+" le "+e.fiche.date+"</b></div>"),$("#R").html(""),$("#idfiche").val(e.fiche.idfiche),$("#idobs").val("Nouv"),cache2(),$("#BttN").show())),e.photo&&($(".cropit-preview-image").removeAttr("src"),$(".cropit-preview-background").removeAttr("src"),$(".hidden-image-data").val(""),$("#aphoto").val(""),$("#adphoto").removeClass("fa-minus").addClass("fa-camera"),$("#photo").hide(),$("#file").val(""),$("#paysage").attr("checked","checked"),$("#sexe").val(""))}else $("#R").html(""),$("#R1").html(""),$("#listeobs").html(""),alert(e.statut);$("#valajaxs").hide()}})}function efface(e){"use strict";$(e+" :input").not(":button, :submit, :reset, #det, #stade, #etude, #floutage, #typedon, #org, #source, #idfiche, #idobs, #sel, input[name=orien], input[name=clabon]").val(""),$("#observateur2").val(""),$("#habitat").val("NR"),$("#habitat2").hide(),$("#habitat3").hide(),$("#cdnombotam").val(""),$("#nbpltem").val(""),$("#statutobs").val("Pr"),$("#denom").val("Co"),$("#tdenom").val("IND"),$("#etatbio").val("2"),$("#etude").val("0"),$("input[name=clabon]").prop("checked",!1),$("#nbtmp").hide(),$("#estim").hide(),$("#nbmin").val(""),$("#nbmax").val(""),$(".nbexact").val(""),$(".nbexact").prop("disabled",!1),$("#nbtmp1").val(""),$("#iddet").val($("#iddetor").val()),$("#idobser").val($("#idobseror").val()),$(".afcarte").show(),$("#valf").hide(),$(".stadecache").find(":input").css("background-color","#FFFFFF").css("cursor","auto"),$("#observateur2").prop("disabled",!1),$("#nomb").prop("disabled",!0).css("cursor","Not-Allowed"),$("#mrq").prop("checked",!1),$("#collect").is(":checked")&&$("#collect").prop("checked",!1),$("#gen").is(":checked")&&$("#gen").prop("checked",!1),$("#imgpluscol").hasClass("fa-minus")&&($("#imgpluscol").removeClass("fa-minus").addClass("fa-plus"),$("#pluscol").hide()),marker&&(map.removeLayer(marker),marker=""),drawnItems.getLayers().length>0&&drawnItems.clearLayers(),nonsite(),supmarker()}function cache(){"use strict";$("#observateur2").prop("disabled",!0).css("cursor","Not-Allowed"),$(".stadecache").find(":input").css("background-color","#EEEEEE").css("cursor","Not-Allowed"),$("#cdnombota").val(""),$("#nbplte").val(""),$(".nbexact").val(""),$("#nbmin").val(""),$("#nbmax").val(""),$("#denom").val("Co"),$("#tdenom").val("IND"),$(".nbexact").prop("disabled",!1),$("#choixplte").val(""),$("#nbpltel").val(""),$("#ulplante").html(""),$("#collect").is(":checked")&&($("#collect").prop("checked",!1),$("#detcol").val(""),$("#iddetcol").val("")),$("#gen").is(":checked")&&($("#gen").prop("checked",!1),$("#codegen").val(""),$("#detgen").val(""),$("#prepgen").val(""),$("#iddetgen").val(""),$("#idprep").val(""),$("#typegen").val("NR"),$("#sexegen").val("")),$("#imgpluscol").hasClass("fa-minus")&&($("#imgpluscol").removeClass("fa-minus").addClass("fa-plus"),$("#pluscol").hide()),$("#mrq").is(":checked")||$("#rq").val("")}function cache2(){"use strict";$("#observateur2").prop("disabled",!0).css("cursor","Not-Allowed"),$("#cdnombota").val(""),$("#nbplte").val(""),$("#nicheur").html(""),$("#indnid").val("0"),$(".ndecache :input").not(":button, :submit, :reset, #det, #stade, #denom, #tdenom, #etude, #protocol, #etatbio, #habitat, #habitat2, #habitat3").val(""),$(".ndecache").find(":input").css("background-color","#FFFFFF").css("cursor","auto"),$("#statutobs").val("Pr"),$(".nbexact").val(""),$("#nbmin").val(""),$("#nbmax").val(""),$("#nbtmp1").val(""),$("input[name=clabon]").prop("checked",!1),$("#cdnom").val(""),$("#cdref").val(""),$("#choixplte").val(""),$("#nbpltel").val(""),$("#ulplante").html("");var e=$("#choixauto").val();$("#"+e).focus(),$("#collect").is(":checked")&&($("#collect").prop("checked",!1),$("#detcol").val(""),$("#iddetcol").val("")),$("#gen").is(":checked")&&($("#gen").prop("checked",!1),$("#codegen").val(""),$("#detgen").val(""),$("#prepgen").val(""),$("#iddetgen").val(""),$("#idprep").val(""),$("#typegen").val("NR"),$("#sexegen").val("")),$("#imgpluscol").hasClass("fa-minus")&&($("#imgpluscol").removeClass("fa-minus").addClass("fa-plus"),$("#pluscol").hide()),$("#mrq").is(":checked")||$("#rq").val("")}function affichelisteobs(e){afficheobs(),$("html, body").animate({scrollTop:0},"slow"),$.post("modeles/ajax/saisie/listeobs.php",{idfiche:e,ordre:"S"},function(e){$("#listeobs").html(e)}),sel=$("#sel").val(),"aucun"!=sel&&choixobser(sel)}function recupfiche(e){"use strict";$.ajax({url:"modeles/ajax/saisie/recupfiche.php",type:"POST",dataType:"json",data:{idfiche:e},success:function(e){if("Oui"==e.statut){if($(".afcarte").hide(),$("#xlambert").val(""),$("#ylambert").val(""),$("#altitude").val(""),$("#l93").val(""),$("#l935").val(""),$("#lat").val(""),$("#lng").val(""),$("#communeb").val(e.fiche.commune),$("#lieub").val(e.fiche.site),$("#date").val(e.fiche.date1fr),$("#date2").val(e.fiche.date2fr),$("#idfiche").val(e.fiche.idfiche),$("#codecom").val(e.fiche.codecom),$("#codedep").val(e.fiche.iddep),$("#codesite").val(e.fiche.idsite),$("#idcoord").val(e.fiche.idcoord),$("#pr").val(e.fiche.localisation),$("#typepoly").val(e.fiche.geo),$("#typedon").val(e.fiche.typedon),$("#source").val(e.fiche.source),$("#floutage").val(e.fiche.floutage),$("#heure").val(e.fiche.hdebut),$("#heure2").val(e.fiche.hfin),$("#tempdeb").val(e.fiche.tempdebut),$("#tempfin").val(e.fiche.tempfin),$("#valf").show(),e.fiche.idorg&&$("#org").val(e.fiche.idorg),"Pr"!=e.fiche.typedon&&$("#foutagecache").hide(),e.fiche.site||(nonsite(),0==e.fiche.idsite&&$("#codesite").val("Nouv")),e.idobser&&($("#observateur2").val(e.obser),$("#idobser").val(e.idobser)),1==e.fiche.localisation&&e.fiche.lat){supmarker(),mod="oui";var a=e.fiche.lat+","+e.fiche.lng,t=16;centrersite(a,t,e.fiche.geo)}if(2==e.fiche.localisation&&e.fiche.lat){supmarker();var a=e.fiche.lat+","+e.fiche.lng,t=13;centrer(a,t,e.fiche.codecom)}}else alert("problème ! pour récupérer les informations de la fiche")}})}function suppobs(e,a){"use strict";$("#idobs").val(e),$("#encours").val(a),$("#dia7").modal("show")}function suppressiont(e){"use strict";$("#dia6").modal("hide"),$.ajax({url:"modeles/ajax/saisie/supobs.php",type:"POST",dataType:"json",data:{idligne:"tous",idobs:e},success:function(e){"Oui"==e.statut&&($("#R").html('<p class="text-success"><i class="fa fa-check"></i> Donnée supprimée</p>'),$("#R1").html(""),$("#idfiche").val("Nouv"),$("#idobs").val("Nouv"),$("#listeobs").html(""),efface("#formulaire"),affichefiche(),$("#observateur2").focus(),$("html, body").animate({scrollTop:0},"slow"))}})}function suppression(e,a,t,l){"use strict";1==t&&$("#dia6").modal("hide"),$.ajax({url:"modeles/ajax/saisie/supobs.php",type:"POST",dataType:"json",data:{idligne:e,idobs:a},success:function(e){"Oui"==e.statut?1==l?($("#R").html('<p class="text-success"><i class="fa fa-check"></i> Donnée supprimée</p>'),$("#R1").html(""),$("#idfiche").val("Nouv"),$("#idobs").val("Nouv"),$("#listeobs").html(""),efface("#formulaire"),affichefiche(),$("#observateur2").focus(),$("html, body").animate({scrollTop:0},"slow")):1==e.nbobs?($("#R").html('<p class="text-success"><i class="fa fa-check"></i> Donnée supprimée</p>'),$("#R1").html(""),$("#idfiche").val("Nouv"),$("#idobs").val("Nouv"),$("#listeobs").html(""),efface("#formulaire"),affichefiche(),$("#observateur2").focus(),$("html, body").animate({scrollTop:0},"slow")):($("#R1").html('<div class="alert alert-success"><i class="fa fa-check"></i> Donnée supprimée</div>'),$("#R").html(""),$("#idfiche").val("Nouv"),$("#idobs").val("Nouv"),$("#T"+a).remove(),$("#observateur2").focus(),$("html, body").animate({scrollTop:0},"slow")):alert("problème ! lors de la suppression ")}})}function modobs(e){"use strict";$.ajax({url:"modeles/ajax/saisie/modobs.php",type:"POST",dataType:"json",data:{idobs:e},success:function(a){if("Oui"==a.statut)if(afficheobs(),choixobser(a.sel),$("#sel").val(a.sel),$(".list-inline").find("li").removeClass("text-primary"),$("#"+a.sel).addClass("text-primary"),1==a.nbligne)recupinfo(a.ligne,0);else{$("#stademod").text(a.nbligne);var t="",l=1;$.each(a.ligne,function(e,a){t+='<li><i class="fa fa-pencil curseurlien" onclick="recupinfo('+a.idligne+","+l+')"></i> '+a.stade+", "+a.etat+"</li>"}),$("#modligne").html(t),$("#libmod").html("stades ou état biologique pour cette observation. Choisissez la ligne à modifier<br>Nb : Si vous changer le nom d'espèce, cela impactera toutes les lignes."),$("#suptous").html('<span><i class="fa fa-trash curseurlien text-danger" onclick="suppressiont('+e+")\"></i> Supprimer toute l'observation."),$("#dia6").modal({backdrop:"static",show:!0,keyboard:!1})}else alert("problème ! pour récupérer les informations")}})}function recupinfo(e,a){"use strict";1==a&&$("#dia6").modal("hide"),sel=$("#sel").val(),$.ajax({url:"modeles/ajax/saisie/recupligne.php",type:"POST",dataType:"json",data:{idligne:e,sel:sel},success:function(a){"Oui"==a.statut?($(".nbexact").val(""),$("#val").removeClass("d-flex").hide(),$("#valm").addClass("d-flex").show(),$("#idobs").val(a.ligne.idobs),$("#idligneobs").val(e),$("#idfiche").val(a.ligne.idfiche),$("#cdnom").val(a.ligne.cdnom),$("#cdref").val(a.ligne.cdref),$("#nomb").val(a.ligne.nom+" ("+a.ligne.nomvern+")"),$("#det").val(a.ligne.det),$("#stade").val(a.ligne.stade),$("#etatbio").val(a.ligne.idetatbio),$("#statutobs").val(a.ligne.statutobs),$("#statutobs").val(a.ligne.statutobs),$("#obsmethode").val(a.ligne.idmethode),$("#obscoll").val(a.ligne.idpros),$("#bio").val(a.ligne.idstbio),$("#protocol").val(a.ligne.idprotocole),$("#etude").val(a.ligne.idetude),$("#rq").val(a.ligne.rqobs),$("#denom").val(a.ligne.denom),$("#nbmin").val(a.ligne.nbmin),$("#nbmax").val(a.ligne.nbmax),a.ligne.tdenom?$("#tdenom").val(a.ligne.tdenom):$("#tdenom").val("IND"),"Co"==a.ligne.denom&&($(".nbexact").prop("disabled",!1),$("#estim").hide(),$("#nbtmp").hide(),$("#ndiff").val(a.ligne.ndiff),$("#male").val(a.ligne.male),$("#femelle").val(a.ligne.femelle),a.ligne.ndiff+a.ligne.male+a.ligne.femelle==a.ligne.nb?$("#nb").val(""):$("#nb").val(a.ligne.nb),a.ligne.tdenom?"IND"==a.ligne.tdenom||"NSP"==a.ligne.tdenom?($("#nbtmp").hide(),$(".nbexact").prop("disabled",!1)):($("#nbtmp").show(),$("#nbtmp1").val(a.ligne.nbmin),$(".nbexact").prop("disabled",!0)):($("#nbtmp").hide(),$(".nbexact").prop("disabled",!1))),3==a.ligne.idetatbio?($("#cmort").show(),a.mort?$("#mort").val(a.mort):$("#mort").val(0)):($("#cmort").hide(),$("#mort").val(0)),"Es"==a.ligne.denom&&("IND"==a.ligne.tdenom||"NSP"==a.ligne.tdenom?($("#ndiff").val(a.ligne.ndiff),$("#male").val(a.ligne.male),$("#femelle").val(a.ligne.femelle)):$(".nbexact").prop("disabled",!0),(a.ligne.nbmax-(a.ligne.nbmin-1))/2==a.ligne.nb?$("#nb").val(""):$("#nb").val(a.ligne.nb),$("#estim").show(),$("#nbtmp").hide()),a.ligne.cdhab?($("#imgplushab").hasClass("fa-plus")&&($("#imgplushab").removeClass("fa-plus").addClass("fa-minus"),$("#plushab").show()),$("#cdhab").val(a.ligne.cdhab),a.habitat3?($("#habitat").val(a.hab1),$("#habitat2").show(),$("#habitat3").show(),rhab(a.hab1,a.hab2),rhab2(a.hab2,a.ligne.cdhab)):($("#habitat3").hide(),a.habitat2?($("#habitat").val(a.hab1),$("#habitat2").show(),rhab(a.hab1,a.ligne.cdhab)):($("#habitat2").hide(),$("#habitat").val(a.ligne.cdhab)))):($("#cdhab").val(""),$("#habitat2").hide(),$("#habitat3").hide(),$("#imgplushab").hasClass("fa-minus")&&($("#imgplushab").removeClass("fa-minus").addClass("fa-plus"),$("#plushab").hide())),a.aves&&$("#indnid").val(a.aves),a.cdnombota?($("#imgplusplte").hasClass("fa-plus")&&($("#imgplusplte").removeClass("fa-plus").addClass("fa-minus"),$("#pltehote").show()),$("#choixplte").val(""),$("#nbpltel").val(""),$("#cdnombota").val(a.cdnombota),$("#nbplte").val(a.nbbota),$("#ulplante").html(a.listebota)):($("#cdnombota").val(""),$("#nbplte").val(""),$("#ulplante").html(""),$("#choixplte").val(""),$("#nbpltel").val(""),$("#imgplusplte").hasClass("fa-minus")&&($("#imgplusplte").removeClass("fa-minus").addClass("fa-plus"),$("#pltehote").hide())),a.col?($("#imgpluscol").hasClass("fa-plus")&&($("#imgpluscol").removeClass("fa-plus").addClass("fa-minus"),$("#pluscol").show()),a.colobser?($("#collect").prop("checked",!0),$("#iddetcol").val(a.col.iddetcol),$("#detcol").val(a.colobser)):($("#collect").prop("checked",!1),$("#detcol").val(""),$("#iddetcol").val("")),a.colprep?($("#gen").prop("checked",!0),$("#codegen").val(a.col.codegen),$("#prepgen").val(a.colprep),$("#typegen").val(a.col.typedet),$("#sexegen").val(a.col.sexe),$("#iddetgen").val(a.col.iddetgen),$("#idprep").val(a.col.idprep),a.coldetgen?$("#detgen").val(a.coldetgen):$("#detgen").val("")):($("#gen").prop("checked",!1),$("#codegen").val(""),$("#detgen").val(""),$("#prepgen").val(""),$("#iddetgen").val(""),$("#idprep").val(""),$("#typegen").val("NR"),$("#sexegen").val(""))):$("#imgpluscol").hasClass("fa-minus")&&($("#imgpluscol").removeClass("fa-minus").addClass("fa-plus"),$("#pluscol").hide())):alert("problème ! pour récupérer les informations")}})}function rhab(e,a){$.post("modeles/ajax/saisie/listehabitat.php",{cdhab:e,niv:2},function(e){$("#habitat2").html(e),$("#habitat2").val(a)})}function rhab2(e,a){$.post("modeles/ajax/saisie/listehabitat.php",{cdhab:e,niv:3},function(e){$("#habitat3").html(e),$("#habitat3").val(a)})}function valimodif(e){"use strict";var a=$("#protocol").val(),t=$("#etude").val(),l=$("#statutobs").val();"No"==l&&0==a&&0==t?($("#valajaxs").hide(),$("#R1").html("<div class=\"alert alert-danger\">Il n'est pas possible d'enregistrer ce type d'observation. Une donnée d'absence doit-être liée à un protocole ou à une étude</div>")):enregistrermod(e)}function enregistrermod(e){"use strict";var a=$("#idligneobs").val(),t=$("#stade option:selected").text(),l=$("#nbmin").val(),i=$("#nbmax").val();$.ajax({url:"modeles/ajax/saisie/vmodobs.php",type:"POST",dataType:"json",data:e.serialize()+"&idligne="+a+"&stadeval="+t+"&nbmin="+l+"&nbmax="+i,success:function(e){"Oui"==e.statut?(e.stade?$("#R1").html('<div class="alert alert-success"><i class="fa fa-check"></i> Donnée modifiée, le stade <b>'+e.stade+"</b> a été ajouté</div>"):$("#R1").html('<div class="alert alert-success"><i class="fa fa-check"></i> Donnée modifiée</div>'),e.photo&&($(".cropit-preview-image").removeAttr("src"),$(".cropit-preview-background").removeAttr("src"),$(".hidden-image-data").val(""),$("#aphoto").val(""),$("#adphoto").removeClass("fa-minus").addClass("fa-camera"),$("#photo").hide(),$("#file").val("")),$("#observateur2").focus(),$("html, body").animate({scrollTop:0},"slow")):alert(e.statut),$("#valajaxs").hide()}})}var sel;$(document).ready(function(){"use strict";$("#valajaxs").hide(),$("#pluslatin1").hide(),$("#pluscol").hide(),$("#plushab").hide(),$("#plusproto").hide(),$("#valm").removeClass("d-flex").hide(),$("#photo").hide(),$("#pltehote").hide(),$("#estim").hide(),$("#nbtmp").hide(),$("#habitat2").hide(),$("#habitat3").hide(),$("#nomb").prop("disabled",!0).css("cursor","Not-Allowed"),$("#btnaide").on("click",aide);var e=$("#getidfiche").val();""!=e&&recupfiche(e)}),$("#imgpluslocale").click(function(){"use strict";$(this).hasClass("fa-plus")?($(this).removeClass("fa-plus").addClass("fa-minus"),$("#latin1").val(""),$("#pluslatin1").slideDown("slow")):($(this).removeClass("fa-minus").addClass("fa-plus"),$("#pluslatin1").hide())}),$("#imgplusproto").click(function(){"use strict";$(this).hasClass("fa-plus")?($(this).removeClass("fa-plus").addClass("fa-minus"),$("#plusproto").show()):($(this).removeClass("fa-minus").addClass("fa-plus"),$("#plusproto").hide())}),$(".idvar").click(function(){"use strict";sel=$(this).attr("id"),$(".list-inline").find("li").removeClass("text-primary"),$(this).addClass("text-primary"),choixobser(sel)}),$(function(){$("#det").autocomplete({source:function(e,a){$.getJSON("modeles/ajax/saisie/listeobservateur.php",{term:e.term},function(e){a($.map(e,function(e){return{label:e.observateur,value:e.idobser}}))})},select:function(e,a){return this.value=a.item.label,$("#iddet").val(a.item.value),!1},change:function(e,a){a.item||($(this).val($("#observateur").val()),$("#iddet").val($("#idobseror").val()),$("#dia2").modal("show"))}})}),$(function(){$("#latin").autocomplete({source:function(e,a){$.getJSON("modeles/ajax/saisie/listelatin.php",{term:e.term,sel:sel},a)},minLength:1,delay:400,select:function(e,a){return $(this).val(a.item.nom),$("#cdnom").val(a.item.cdnom),$("#cdref").val(a.item.cdref),$("#nomf").val(""),$("#newsp").val(""),$("#tvali").val(a.item.vali),a.item.cdnom==a.item.cdref?$("#nomb").val(a.item.nom):cdref(a.item.cdref),a.item.stade?mesvali(a.item.stade,a.item.photo,a.item.son,a.item.loupe,a.item.bino):$("#mesvali").html(""),$("#choixauto").val("latin"),$("#stade").focus(),!1}}).data("ui-autocomplete")._renderItem=function(e,a){return a.cdnom==a.cdref?$("<li><b>"+a.nom+"</b> "+a.auteur+"</li>").appendTo(e):$("<li>"+a.nom+" "+a.auteur+"</li>").appendTo(e)}}),$(function(){$("#latin1").autocomplete({source:function(e,a){$.getJSON("modeles/ajax/saisie/listelatin1.php",{term:e.term,sel:sel},a)},minLength:1,delay:400,select:function(e,a){return $("#cdnom").val(a.item.cdnom),$("#cdref").val(a.item.cdref),$("#latin").val(a.item.nom),$("#nomf").val(""),$("#tvali").val(2),a.item.cdnom==a.item.cdref?$("#nomb").val(a.item.nom):cdref(a.item.cdref),$("#pluslatin1").hide(),$("#imgpluslocale").removeClass("fa-minus").addClass("fa-plus"),$("#newsp").val("oui"),$("#choixauto").val("latin"),$("#stade").focus(),!1}}).data("ui-autocomplete")._renderItem=function(e,a){return a.cdnom==a.cdref?$("<li><b>"+a.nom+"</b> "+a.auteur+"</li>").appendTo(e):$("<li>"+a.nom+" "+a.auteur+"</li>").appendTo(e)}}),$("#nomf").autocomplete({source:function(e,a){$.getJSON("modeles/ajax/saisie/listenomfr.php",{term:e.term,sel:sel},function(e){a($.map(e,function(e){return{label:e.nomvern+" ("+e.nom+")",value:e}}))})},select:function(e,a){var t=a.item.value;return $("#nomf").val(t.nomvern),$("#cdnom").val(t.cdnom),$("#cdref").val(t.cdref),$("#latin").val(""),$("#newsp").val(""),$("#tvali").val(t.vali),t.cdnom==t.cdref?$("#nomb").val(t.nom+" "+t.nomvern):cdref(t.cdref),t.stade?mesvali(t.stade,t.photo,t.son,t.loupe,t.bino):$("#mesvali").html(""),$("#choixauto").val("nomf"),$("#stade").focus(),!1}}),$(".info").click(function(){"use strict";var e=$(this).attr("id");"infolieu"==e?$.post("modeles/ajax/saisie/infoaide.php",{},function(e){$("#rinfoaide").html(e),$("#dia15").modal("show")}):$.post("modeles/ajax/saisie/infoattr.php",{id:e,sel:sel},function(e){$("#rinfo").html(e),$("#dia14").modal("show")})}),$("#imgplushab").click(function(){"use strict";$(this).hasClass("fa-plus")?($(this).removeClass("fa-plus").addClass("fa-minus"),$("#plushab").show()):($(this).removeClass("fa-minus").addClass("fa-plus"),$("#plushab").hide())}),$("#habitat").change(function(){"use strict";var e=$("#habitat").val(),a=2;"NR"!=e?($("#cdhab").val(e),$("#habitat2").show(),$("#habitat3").hide(),$.post("modeles/ajax/saisie/listehabitat.php",{cdhab:e,niv:a},function(e){$("#habitat2").html(e)})):($("#cdhab").val(""),$("#habitat2").hide())}),$("#habitat2").change(function(){"use strict";var e=$("#habitat2").val(),a=3;"NR"!=e?($("#cdhab").val(e),$("#habitat3").show(),$.post("modeles/ajax/saisie/listehabitat.php",{cdhab:e,niv:a},function(e){$("#habitat3").html(e)})):($("#cdhab").val($("#habitat").val()),$("#habitat3").hide())}),$("#habitat3").change(function(){"use strict";var e=$("#habitat3").val();"NR"!=e?$("#cdhab").val(e):$("#cdhab").val($("#habitat2").val())}),$("#statutobs").change(function(){"use strict";var e=$("#statutobs").val();"No"==e?($("#denom").prop("disabled",!0),$("#tdenom").prop("disabled",!0),$(".nbexact").prop("disabled",!0),$("#protocol").focus(),$("#estim").hide(),$("#BttS").hide(),$(".nbexact").val(""),$("#nbmax").val(0),$("#nbmin").val(0)):($("#denom").prop("disabled",!1),$("#tdenom").prop("disabled",!1),$(".nbexact").prop("disabled",!1),$("#denom").focus(),$("#BttS").show())}),$("#denom").change(function(){"use strict";var e=$("#denom").val();"NSP"==e?($(".nbexact").prop("disabled",!0),$("#obsmethode").focus(),$(".nbexact").val(""),$("#nbmax").val(""),$("#nbmin").val(""),$("#estim").hide(),$("#tdenom").prop("disabled",!0)):($("#tdenom").prop("disabled",!1),"Co"==e?($("#estim").hide(),$(".nbexact").prop("disabled",!1),$("#nbmax").val(""),$("#nbmin").val(""),$("#ndiff").focus()):($(".nbexact").prop("disabled",!1),$("#estim").show(),$(".nbexact").val(""),$("input[name=clabon]").prop("checked",!1),$("#nbtmp").hide()))}),$("#tdenom").change(function(){var e=$("#tdenom").val(),a=$("#denom").val();"Co"==a?($(".nbexact").val(""),"IND"==e||"NSP"==e?($("#nbmin").val(""),$("#nbmax").val(""),$(".nbexact").prop("disabled",!1),$("#ndiff").focus(),$("#nbtmp").hide()):($(".nbexact").prop("disabled",!0),$("#nbtmp1").val(""),$("#nbtmp").show(),$("#nbtmp1").focus())):($("#nbtmp").hide(),"IND"==e||"NSP"==e?$(".nbexact").prop("disabled",!1):$(".nbexact").prop("disabled",!0))}),$("#nbtmp1").change(function(){"use strict";var e=$(this).val(),a=$("#tdenom").val();$("#nbmin").val(e),$("#nbmax").val(e),"CPL"==a&&($("#male").val(e),$("#femelle").val(e))}),$(".nbexact").change(function(){"use strict";var e=""!=$("#ndiff").val()?$("#ndiff").val():0,a=""!=$("#male").val()?$("#male").val():0,t=""!=$("#femelle").val()?$("#femelle").val():0,l=parseInt(e)+parseInt(a)+parseInt(t);$("#nbmin").val(l),$("#nbmax").val(l)}),$("input[name=clabon]").change(function(){"use strict";var e=$("#tdenom").val();"IND"!=e&&"NSP"!=e||$(".nbexact").val("");var a=$("input[name=clabon]:checked").val();"cl1"==a&&($("#nbmin").val(1),$("#nbmax").val(10)),"cl2"==a&&($("#nbmin").val(11),$("#nbmax").val(100)),"cl3"==a&&($("#nbmin").val(101),$("#nbmax").val(1e3)),"cl4"==a&&($("#nbmin").val(1001),$("#nbmax").val(1e4)),"cl5"==a&&($("#nbmin").val(1e4),$("#nbmax").val(""))}),$("#etatbio").change(function(){"use strict";3==$(this).val()?$("#cmort").show():($("#cmort").hide(),$("#mort").val(0))}),$("#indnid").change(function(){"use strict";var e=$("#indnid").val();0==e?$("#nicheur").html(""):e<=3?$("#nicheur").html("Nidification possible"):e>3&&e<=10?$("#nicheur").html("Nidification probable"):e>10&&$("#nicheur").html("Nidification certaine")}),$("#imgpluscol").click(function(){"use strict";$(this).hasClass("fa-plus")?($(this).removeClass("fa-plus").addClass("fa-minus"),$("#pluscol").slideDown("slow"),$("#detcol").prop("disabled",!0),$("#detgen").prop("disabled",!0),$("#codegen").prop("disabled",!0),$("#prepgen").prop("disabled",!0),$("#typegen").prop("disabled",!0),$("#sexegen").prop("disabled",!0)):($(this).removeClass("fa-minus").addClass("fa-plus"),$("#pluscol").hide())}),$("#collect").click(function(){"use strict";$("#collect").is(":checked")?($("#detcol").prop("disabled",!1),$("#detcol").focus(),$("#detcol").val($("#det").val()),$("#iddetcol").val($("#iddet").val())):($("#iddetcol").val(""),$("#detcol").prop("disabled",!0).val(""))}),$("#gen").click(function(){"use strict";$("#gen").is(":checked")?($("#detgen").prop("disabled",!1),$("#codegen").prop("disabled",!1),$("#prepgen").prop("disabled",!1),$("#typegen").prop("disabled",!1),$("#sexegen").prop("disabled",!1),$("#prepgen").val($("#det").val()),$("#idprep").val($("#iddet").val()),$("#detgen").val($("#detcol").val()),$("#iddetgen").val($("#iddetcol").val()),$("#typegen").focus()):($("#codegen").prop("disabled",!0).val(""),$("#iddetgen").val(""),$("#idprep").val(""),$("#detgen").prop("disabled",!0).val(""),$("#prepgen").prop("disabled",!0).val(""),$("#typegen").prop("disabled",!0).val("NR"),$("#sexegen").prop("disabled",!0).val(""))}),$("#detcol").autocomplete({source:function(e,a){$.getJSON("modeles/ajax/saisie/listeobservateur.php",{term:e.term},function(e){
a($.map(e,function(e){return{label:e.observateur,value:e.idobser}}))})},select:function(e,a){return this.value=a.item.label,$("#iddetcol").val(a.item.value),!1}}),$("#detgen").autocomplete({source:function(e,a){$.getJSON("modeles/ajax/saisie/listeobservateur.php",{term:e.term},function(e){a($.map(e,function(e){return{label:e.observateur,value:e.idobser}}))})},select:function(e,a){return this.value=a.item.label,$("#iddetgen").val(a.item.value),!1}}),$("#prepgen").autocomplete({source:function(e,a){$.getJSON("modeles/ajax/saisie/listeobservateur.php",{term:e.term},function(e){a($.map(e,function(e){return{label:e.observateur,value:e.idobser}}))})},select:function(e,a){return this.value=a.item.label,$("#idprep").val(a.item.value),!1}}),$("#imgplusplte").click(function(){"use strict";$(this).hasClass("fa-plus")?($(this).removeClass("fa-plus").addClass("fa-minus"),$("#latin1").val(""),$("#pltehote").slideDown("slow"),$("#choixplte").val(""),$("#nbpltel").val("")):($(this).removeClass("fa-minus").addClass("fa-plus"),$("#pltehote").hide())}),$("#choixplte").autocomplete({source:function(e,a){$.getJSON("modeles/ajax/saisie/listebota.php",{term:e.term,sel:sel},function(e){a($.map(e,function(e){return""==e.nomvern?{label:e.nom,value:e}:{label:e.nom+" ("+e.nomvern+")",value:e}}))})},select:function(e,a){$("#choixplte").val(a.item.value.nom);var t=$("#cdnombota").val(),l=$("#nbplte").val();return""!=t?($("#cdnombota").val(t+","+a.item.value.cdnom),$("#nbplte").val(l+","+$("#nbpltel").val()),$("#ulplante").prepend("<li>"+$("#nbpltel").val()+" sur "+a.item.value.nom+"</li>")):($("#cdnombota").val(a.item.value.cdnom),$("#nbplte").val($("#nbpltel").val()),$("#ulplante").html("<li>"+$("#nbpltel").val()+" sur "+a.item.value.nom+"</li>")),!1},change:function(e,a){a.item||($(this).val(""),$("#cdnombota").val(""),$("#nbplte").val(""),$("#nbpltel").val(""),$("#ulplante").html(""))}}),$("#bttAplte").click(function(){var e=$("#cdnombota").val();""!=e&&($("#choixplte").val(""),$("#nbpltel").val(""))}),$("#BttV").click(function(){"use strict";$("#BttV").hide(),$("#Bt").val("BttV"),$("#valajaxs").show()}),$("#BttS").click(function(){"use strict";$("#Bt").val("BttS"),$("#valajaxs").show()}),$("#BttN").click(function(){"use strict";$("#BttN").hide(),$("#Bt").val("BttN"),$("#valajaxs").show()}),$("#BttM").click(function(){"use strict";$("#Bt").val("BttM"),$("#valajaxs").show()}),$("#formulaire").on("submit",function(e){"use strict";if($("#R1").html(""),e.preventDefault(),"oui"==$("#aphoto").val()){var a=$("#crop").cropit("export",{type:"image/jpeg",quality:.9,originalSize:!1});$(".hidden-image-data").val(a)}if("BttM"==$("#Bt").val()){var t=$(this);valimodif(t)}else if("Nouv"==$("#idfiche").val()){var l=$("#date").val(),i=$("#xlambert").val();if(""==l||""==i)$("#valajaxs").hide(),""==l&&$("#R1").prepend('<div class="alert alert-danger">Aucune date de saisie ! Renseigner une date ou un intervalle de date</div>'),""==i&&$("#R1").prepend('<div class="alert alert-danger">Aucune coordonnée ! Sélectionner un site déjà existant ou cliquer sur la carte pour en créer un.</div>');else{var t=$(this);valider(t)}}else{var t=$(this);valider(t)}}),$("#listefiche").on("click",".voirliste",function(){"use strict";var e=$(this).parent().parent().attr("id");$(".table").find("tr").removeClass("bg-info"),$("#"+e).addClass("bg-info"),affichelisteobs(e),$("#val").hide(),$("#valm").removeClass("d-flex").hide()}),$("#vobsfiche").on("click",function(){var e=$("#getidfiche").val();affichelisteobs(e),$("#val").hide(),$("#valm").addClass("d-flex").show(),$("#BttM").hide(),$("#BttSM").hide()}),$("#vofiche").on("click",function(){var e=$("#idfiche").val();$("#getidfiche").val(e),affichefiche(),$("html, body").animate({scrollTop:0},"slow"),recupfiche(e)}),$("#listeobs").on("click",".obst",function(){"use strict";var e=$(this).parent().attr("id"),a=e.substring(0,1),t=e.substring(1);$.post("modeles/ajax/saisie/listeobs.php",{idfiche:t,ordre:a},function(e){$("#listeobs").html(e)})}),$("#listeobs").on("click",".modobs",function(){"use strict";var e=$(this).parent().attr("id").substring(1);$(".modobs").removeClass("text-warning"),$(this).addClass("text-warning"),modobs(e),$("#BttM").show(),$("#BttSM").show()}),$("#listeobs").on("click",".suppobs",function(){"use strict";var e=$(this).parent().attr("id").substring(1);suppobs(e,0)}),$("#listefiche").on("click",".ajoutesp",function(){"use strict";var e=$(this).parent().parent().attr("id");$("#idfiche").val(e),afficheobs(),$("html, body").animate({scrollTop:0},"slow"),sel=$("#sel").val(),"aucun"!=sel&&choixobser(sel),$("#afiche").val("oui"),$(".ndecache :input").not(":button, :submit, :reset, #det, #stade, #denom, #etude, #protocol").val(""),$("#statutobs").val("Pr"),$("#etatbio").val("2"),$("#ndiff").val(0),$("#male").val(0),$("#femelle").val(0),$("#cdnom").val(""),$("#cdref").val(""),$("#idobs").val("Nouv"),$("#valm").removeClass("d-flex").hide(),$("#val").show(),$("#BttV").show(),$("#BttS").show(),$("#BttN").show()}),$("#aobsfiche").on("click",function(){$(".ndecache :input").not(":button, :submit, :reset, #det, #stade, #denom, #etude, #protocol").val(""),$("#statutobs").val("Pr"),$("#etatbio").val("2"),$("#ndiff").val(0),$("#male").val(0),$("#femelle").val(0),$("#cdnom").val(""),$("#cdref").val(""),$("#idobs").val("Nouv"),$("#afiche").val("oui"),$("#valm").removeClass("d-flex").hide(),$("#val").show(),$("#BttV").show(),$("#BttS").show(),$("#BttN").show()}),$("#listefiche").on("click",".modfiche",function(){"use strict";var e=$(this).parent().parent().attr("id");$("#getidfiche").val(e),$(".table").find("tr").removeClass("bg-info"),$("#"+e).addClass("bg-info"),affichefiche(),$("html, body").animate({scrollTop:0},"slow"),recupfiche(e)}),$("#bttdiaN13").click(function(){mod="non",nonsite(),$("#codesite").val("Nouv")}),$("#BttF").click(function(){"use strict";var e=$("#idfiche").val(),a=$("#idcoord").val(),t=$("#codesite").val(),l=$("#xlambert").val(),i=$("#ylambert").val(),s=$("#lat").val(),o=$("#lng").val(),n=$("#l93").val(),c=$("#l935").val(),d=$("#utm").val(),r=$("#utm1").val(),u=$("#typepoly").val(),v=$("#altitude").val(),p=$("#codecom").val(),m=$("#codedep").val(),h=$("#pr").val(),b=$("#lieub").val(),f=$("#date").val(),g=$("#date2").val(),x=$("#idobser").val(),w=$("#typedon").val(),k=$("#floutage").val(),C=$("#source").val(),y=$("#org").val(),N=$("#heure").val(),j=$("#heure2").val(),B=$("#tempdeb").val(),R=$("#tempfin").val();$.ajax({url:"modeles/ajax/saisie/vmodfiche.php",type:"POST",dataType:"json",data:{idfiche:e,idcoord:a,codesite:t,x:l,y:i,lat:s,lng:o,l93:n,l935:c,utm:d,utm1:r,typepoly:u,alt:v,codecom:p,iddep:m,pr:h,site:b,date:f,date2:g,idobser:x,typedon:w,floutage:k,source:C,org:y,heure:N,heure2:j,tempdeb:B,tempfin:R},success:function(e){"Oui"==e.statut?$("#R").html('<div class="alert alert-success"><i class="fa fa-check"></i> Les modifications sur la fiches ont été enregistrées</div>'):alert(e.statut)}})}),$("#bttdia7").click(function(){"use strict";var e=$("#encours").val(),a=$("#idobs").val();if(0==e)$.ajax({url:"modeles/ajax/saisie/modobs.php",type:"POST",dataType:"json",data:{idobs:a},success:function(t){if(1==t.nbligne)suppression(t.ligne,a,0,e);else{$("#stademod").text(t.nbligne);var l="",i=1;$.each(t.ligne,function(t,s){l+='<li><i class="fa fa-trash curseurlien text-danger" onclick="suppression('+s.idligne+","+a+","+i+","+e+')"></i> '+s.stade+"</li>"}),$("#modligne").html(l),$("#libmod").html("stades pour cette observation. Choisissez le stade a supprimé."),$("#suptous").html('<span><i class="fa fa-trash curseurlien text-danger" onclick="suppressiont('+a+")\"></i> Supprimer toute l'observation."),$("#dia6").modal({backdrop:"static",show:!0,keyboard:!1})}}});else{var t=$("#idligneobs").val();suppression(t,a,0,e)}}),$("#BttSM").click(function(){cache(),$("#stade").focus(),$("#BttSM").hide(),$("#idligneobs").val("Nouv")}),$(".BttSA").click(function(){$("#R").html(""),$("#R1").html(""),$("#listeobs").html(""),efface("#formulaire"),affichefiche(),$("#idfiche").val("Nouv"),$("#idobs").val("Nouv"),$("#observateur2").focus(),$("html, body").animate({scrollTop:0},"slow"),$("#valm").removeClass("d-flex").hide(),$("#val").addClass("d-flex").show()}),$("#adphoto").click(function(){"use strict";if($(this).hasClass("fa-camera")){$(this).removeClass("fa-camera").addClass("fa-minus"),$("#photo").slideDown("slow"),$("#BttP").hide(),$("html, body").animate({scrollTop:$("#val").offset().top},"slow");var e=$("#idobser").val(),a=e.split(", ");a[1]?($("#obserphoto").show(),$.post("modeles/ajax/saisie/listeobservateurp.php",{idobser:e},function(e){$("#opph").html(e)})):($("#obserphoto").hide(),$("#opph").html(""))}else $(this).removeClass("fa-minus").addClass("fa-camera"),$("#photo").hide()}),$("input[name=orien]").change(function(){var e=$("input[name=orien]:checked").val();"paysage"==e?(w=400,h=266):(w=200,h=300),$("#crop").cropit("previewSize",{width:w,height:h})}),$("#crop").cropit({exportZoom:2,imageBackground:!0,imageBackgroundBorderWidth:40,width:400,height:266,onImageError:function(e){1===e.code&&$(".error-msg").html('<div class="alert alert-danger">Votre photo est trop petite</div>')}}),$(".cropit-image-input").bind("change",function(){$("#BttP").show(),$("#aphoto").val("oui")}),$(".export").click(function(){"use strict";$("#dia12").modal({backdrop:"static",show:!0,keyboard:!1});var e=$("#crop").cropit("export"),a=$('<img src="'+e+'" />');$("#imgdia12").html(a)}),$(".rotate-ccw").click(function(){$("#crop").cropit("rotateCCW")}),$(".rotate-cw").click(function(){$("#crop").cropit("rotateCW")});