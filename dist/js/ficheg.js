function carte(e){"use strict";var t=$("#emprise").val(),a=$("#cdnom").val(),o=$("#utm").val(),i=$("#nomvar").val(),r=$("#nbgenresp").val(),n=$("#nom").val();$.ajax({url:"modeles/ajax/fiche/carteficheg.php",type:"POST",dataType:"json",data:{emprise:t,choixcarte:e,cdnom:a,utm:o,nomvar:i,nbgenresp:r,nom:n},success:function(e){"Oui"==e.statut&&($("#titrecarte2").html("du genre <i>"+n+"</i> "),e.data.sp?$("#spc").show():$("#spc").hide(),e.data.deter?$("#dc").show():$("#dc").hide(),r>0&&$("#tous").prop("checked",!0),"non"==e.maille&&cartecommune(e.data,e.carto,n),"oui"==e.maille&&(e.maille5?cartemaille5(e.data,e.carto,n,e.maille10):cartemaille(e.data,e.carto,n)))}})}function cartecommune(e,t,a){"use strict";var o="fr"!=$("#emprise").val()?"com":"dep",i=Highcharts.geojson(t,"map");$("#container").highcharts("Map",{legend:{enabled:!1},navigation:{buttonOptions:{verticalAlign:"top",align:"right",width:28,height:28,symbolX:14,symbolY:14,symbolStroke:"white",theme:{fill:couleur1,"stroke-width":0,r:0,states:{hover:{fill:"#ccc"},select:{stroke:"#039",fill:"#ccc"}}}}},mapNavigation:{enableMouseWheelZoom:!1,enabled:!0,buttonOptions:{verticalAlign:"bottom",align:"right"},buttons:{zoomIn:{style:{color:"white"},theme:{fill:couleur1,"stroke-width":0,r:0}},zoomOut:{style:{color:"white"},theme:{fill:couleur2,"stroke-width":0,r:0}}}},exporting:{chartOptions:{title:{text:a}},filename:a},plotOptions:{series:{point:{events:{click:function(){ouvremodal(this.id,o,this.nom)}}}}},tooltip:{backgroundColor:null,borderWidth:0,shadow:!1,useHTML:!0,formatter:function(){return'<div class="popupcarte" style="background-color:'+this.point.color+'"><b>'+this.point.nom+"</b><br>"+this.point.info+"</div>"}},series:[{mapData:i,data:e.tous,joinBy:["id","id"],name:"Commune",borderColor:"black",borderWidth:1,cursor:"pointer",states:{hover:{borderWidth:1.5}}},{data:dep,type:"mapline",lineWidth:1.5,color:"black",enableMouseTracking:!1}]}),$("input[name=setdata]").change(function(){var t=$("input[name=setdata]:checked").val();"tous"==t&&($("#container").highcharts().series[0].setData(e.tous.slice(),!0,!0,!1),$("#titrecarte2").html("du genre <i>"+a+"</i> ")),"sp"==t&&($("#container").highcharts().series[0].setData(e.sp.slice(),!0,!0,!1),$("#titrecarte2").html("des <i>"+a+"</i> sp. ")),"d"==t&&($("#container").highcharts().series[0].setData(e.deter.slice(),!0,!0,!1),$("#titrecarte2").html("des <i>"+a+"</i> déterminée ")),e.c&&$.each(e.c,function(a,o){if(t==a){$("#container").highcharts().series[0].setData(e.c[a].slice(),!0,!0,!1);var i=$("#lab"+a).text();$("#titrecarte2").html("des <i>"+i+"</i> ")}})})}function cartemaille(e,t,a){"use strict";$.getJSON("../emprise/contour.geojson",function(o){var i=Highcharts.geojson(o,"mapline"),r=Highcharts.geojson(t,"map");$("#container").highcharts("Map",{legend:{enabled:!1},navigation:{buttonOptions:{verticalAlign:"top",align:"right",width:28,height:28,symbolX:14,symbolY:14,symbolStroke:"white",theme:{fill:couleur1,"stroke-width":0,r:0,states:{hover:{fill:"#ccc"},select:{stroke:"#039",fill:"#ccc"}}}}},mapNavigation:{enableMouseWheelZoom:!1,enabled:!0,buttonOptions:{verticalAlign:"bottom",align:"right"},buttons:{zoomIn:{style:{color:"white"},theme:{fill:couleur1,"stroke-width":0,r:0}},zoomOut:{style:{color:"white"},theme:{fill:couleur2,"stroke-width":0,r:0}}}},exporting:{chartOptions:{title:{text:a}},filename:a},plotOptions:{series:{point:{events:{click:function(){ouvremodal(this.id,"maille",this.nom)}}}}},tooltip:{backgroundColor:null,borderWidth:0,shadow:!1,useHTML:!0,formatter:function(){return'<div class="popupcarte" style="background-color:'+this.point.color+'"><b>'+this.point.nom+"</b><br>"+this.point.info+"</div>"}},series:[{mapData:r,type:"map",data:e.tous,joinBy:["id","id"],name:"Observation(s)",borderColor:"black",borderWidth:.5,cursor:"pointer",states:{hover:{borderWidth:1.5}}},{data:i,type:"mapline",name:"Commune",lineWidth:.3,color:"black",enableMouseTracking:!1},{data:dep,type:"mapline",lineWidth:1.5,color:"black",enableMouseTracking:!1}]}),$("input[name=setdata]").change(function(){var t=$("input[name=setdata]:checked").val();"tous"==t&&($("#container").highcharts().series[0].setData(e.tous.slice(),!0,!0,!1),$("#titrecarte2").html("du genre <i>"+a+"</i> ")),"sp"==t&&($("#container").highcharts().series[0].setData(e.sp.slice(),!0,!0,!1),$("#titrecarte2").html("des <i>"+a+"</i> sp. ")),"d"==t&&($("#container").highcharts().series[0].setData(e.deter.slice(),!0,!0,!1),$("#titrecarte2").html("des <i>"+a+"</i> déterminée ")),e.c&&$.each(e.c,function(a,o){if(t==a){$("#container").highcharts().series[0].setData(e.c[a].slice(),!0,!0,!1);var i=$("#lab"+a).text();$("#titrecarte2").html("des <i>"+i+"</i> ")}})})})}function cartemaille5(e,t,a,o){"use strict";$.getJSON("../emprise/contour.geojson",function(i){var r=Highcharts.geojson(i,"mapline"),n=Highcharts.geojson(o,"map"),l=Highcharts.geojson(t,"map");$("#container").highcharts("Map",{legend:{enabled:!1},navigation:{buttonOptions:{verticalAlign:"top",align:"right",width:28,height:28,symbolX:14,symbolY:14,symbolStroke:"white",theme:{fill:couleur1,"stroke-width":0,r:0,states:{hover:{fill:"#ccc"},select:{stroke:"#039",fill:"#ccc"}}}}},mapNavigation:{enableMouseWheelZoom:!1,enabled:!0,buttonOptions:{verticalAlign:"bottom",align:"right"},buttons:{zoomIn:{style:{color:"white"},theme:{fill:couleur1,"stroke-width":0,r:0}},zoomOut:{style:{color:"white"},theme:{fill:couleur2,"stroke-width":0,r:0}}}},plotOptions:{series:{point:{events:{click:function(){ouvremodal(this.id,"maille5",this.nom)}}}}},tooltip:{backgroundColor:null,borderWidth:0,shadow:!1,useHTML:!0,formatter:function(){return'<div class="popupcarte" style="background-color:'+this.point.color+'"><b>'+this.point.nom+"</b><br>"+this.point.info+"</div>"}},series:[{mapData:l,type:"map",data:e.tous,joinBy:["id","id"],name:"Observation(s)",borderColor:"black",borderWidth:.5,cursor:"pointer",states:{hover:{borderWidth:1.5}}},{data:n,type:"mapline",name:"Maille",lineWidth:.5,color:"black",dashStyle:"LongDash",enableMouseTracking:!1},{data:r,type:"mapline",name:"Commune",lineWidth:.3,color:"black",enableMouseTracking:!1},{data:dep,type:"mapline",lineWidth:1.5,color:"black",enableMouseTracking:!1}]}),$("input[name=setdata]").change(function(){var t=$("input[name=setdata]:checked").val();"tous"==t&&($("#container").highcharts().series[0].setData(e.tous.slice(),!0,!0,!1),$("#titrecarte2").html("du genre <i>"+a+"</i> ")),"sp"==t&&($("#container").highcharts().series[0].setData(e.sp.slice(),!0,!0,!1),$("#titrecarte2").html("des <i>"+a+"</i> sp. ")),"d"==t&&($("#container").highcharts().series[0].setData(e.deter.slice(),!0,!0,!1),$("#titrecarte2").html("des <i>"+a+"</i> déterminée ")),e.c&&$.each(e.c,function(a,o){if(t==a){$("#container").highcharts().series[0].setData(e.c[a].slice(),!0,!0,!1);var i=$("#lab"+a).text();$("#titrecarte2").html("des <i>"+i+"</i> ")}})})})}function graph(){"use strict";var e=$("#cdnom").val(),t=$("#nomvar").val(),a=$("#nom").val();$.ajax({url:"modeles/ajax/fiche/graphficheg.php",type:"POST",dataType:"json",data:{cdnom:e,nomvar:t,nom:a},success:function(e){if("Oui"==e.statut){var t=e.decade,a=e.serie2,o=e.serie6,i=e.serie13,r=e.serie1,n=e.tab2,l=e.tab6,s=e.tab13,c=e.tab1;graphpheno(t,a,o,i,r,n,l,s,c)}}})}function graphpheno(e,t,a,o,i,r,n,l,s){"use strict";var c=e,m=e+1;$("#graphpheno").highcharts({chart:{type:"column"},navigation:{buttonOptions:{verticalAlign:"top",align:"right",width:28,height:28,symbolX:14,symbolY:14,symbolStroke:"white",theme:{fill:couleur1,"stroke-width":0,r:0,states:{hover:{fill:"#ccc"},select:{stroke:"#039",fill:"#ccc"}}}}},xAxis:{categories:["Ja1","Ja2","Ja3","Fe1","Fe2","Fe3","Ma1","Ma2","Ma3","Av1","Av2","Av3","M1","M2","M3","Ju1","Ju2","Ju3","Jl1","Jl2","Jl3","A1","A2","A3","S1","S2","S3","O1","O2","O3","N1","N2","N3","D1","D2","D3"],plotBands:[{color:"#FCFFC5",from:c,to:m}],labels:{staggerLines:2}},yAxis:{min:0,allowDecimals:!1,title:{text:"Nombre d'observations",style:{fontWeight:"bold"}}},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y}},plotOptions:{column:{stacking:"normal",pointPadding:0,borderWidth:0}},series:[{name:t,data:r},{name:a,data:n},{name:o,data:l},{name:i,data:s}]})}function observateur(){var e=$("#cdnom").val(),t=$("#nomvar").val(),a=$("#nom").val();$.ajax({url:"modeles/ajax/fiche/obserfiche.php",type:"POST",dataType:"json",data:{cdnom:e,nomvar:t,nom:a,rang:"GN"},success:function(e){"Oui"==e.statut&&($("#nbobser").html("("+e.nb+")"),$("#listeobser").html(e.listeobser))}})}function ouvremodal(e,t,a){$("#idc").val(e),$("#typec").val(t),$("#nomc").val(a),$("#infos").modal()}function carteleaflet(e){"use strict";var t={color:"#ff7800",weight:5,opacity:.65};if(proj4.defs("EPSG:2154","+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"),"oui"==nbmap){nbmap="non",map=new L.map("mapdetail");var a=new L.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});map.addLayer(a),com=L.Proj.geoJson(e,{style:t}).addTo(map),map.fitBounds(com.getBounds())}else com=L.Proj.geoJson(e,{style:t}).addTo(map),map.fitBounds(com.getBounds())}var dep,pheno,obser,couleur1,couleur2;$(document).ready(function(){"use strict";couleur1=$("#logomlightl").css("backgroundColor"),couleur2=$("#navigation").css("backgroundColor"),$(".popup-gallery").magnificPopup({delegate:"a",type:"image",tLoading:"Chargement image #%curr%...",mainClass:"mfp-img-mobile",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">Cette image #%curr%</a> est absente..',titleSrc:function(e){return e.el.attr("title")}}});var e=$("#choixcarte").val();"maille"==e&&$("#maille").attr("checked","checked"),carte(e),dep="oui"==$("#contour2").val()?$.getJSON("../emprise/contour2.geojson",function(e){dep=Highcharts.geojson(e,"mapline")}):""}),$("input[name=choixcarte]").change(function(){"use strict";var e=$("input[name=choixcarte]:checked").val();if("commune"==e&&("fr"!=$("#emprise").val()?$("#titrecarte").html("Répartition communale "):$("#titrecarte").html("Répartition départementale "),$("#container").html('<div class="mt-2"><p class="text-warning text-center"><span class="fa fa-spin fa-spinner fa-2x"></span> Chargement de la carte...</p></div>'),carte(e)),"maille"==e){$("#container").html('<div class="mt-2"><p class="text-warning text-center"><span class="fa fa-spin fa-spinner fa-2x"></span> Chargement de la carte...</p></div>');var t=$("#utm").val();"oui"==t?$("#titrecarte").html("Répartition par maille UTM "):$("#titrecarte").html("Répartition par maille 10 x 10 "),carte(e)}"maille5"==e&&($("#titrecarte").html("Répartition par maille 5 x 5 "),carte(e))}),Highcharts.setOptions({lang:{contextButtonTitle:"Menu exportation",downloadPNG:"Télécharger au format PNG",downloadJPEG:"Télécharger au format JPG",downloadPDF:"Télécharger au format PDF",downloadSVG:"Télécharger au format SVG",exportButtonTitle:"Exporter image ou document",printChart:"Imprimer",zoomIn:"Zoom +",zoomOut:"Zoom -",loading:"Chargement..."},title:{text:""},credits:{enabled:!1},colors:["#4d5b73","#6f85a1","#a89297","#a7bac9","#d6bcbd"]}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){"use strict";var t=$(e.target).attr("data-id");"phenologie"==t&&"oui"!=pheno&&(pheno="oui",graph()),"observateur"==t&&"oui"!=obser&&(obser="oui",observateur())});var map,nbmap="oui",com;$("#infos").on("shown.bs.modal",function(){"use strict";var e=$("#utm").val(),t=$("#idc").val(),a=$("#typec").val(),o=$("#nomc").val(),i=$("#cdnom").val(),r=$("#nom").val(),n=$("#nomvar").val();$.ajax({url:"modeles/ajax/fiche/modalficheg.php",type:"POST",dataType:"json",data:{id:t,type:a,utm:e,cdnom:i,genre:r,nomvar:n},success:function(i){if("Oui"==i.statut){if(carteleaflet(i.carto),setTimeout(function(){map.invalidateSize()},400),"maille"==a)if("oui"==e)var r="Maille UTM n° "+t;else var r="Maille 10 x 10 km n° "+t;if("com"==a)var r="Commune de "+o;if("dep"==a)var r="Département de "+o;if("maille5"==a)var r="Maille 5 x 5 km n° "+t;$(".modal-title").html(r),$("#listenbobs").html(i.listenbobs)}else alert("erreur")}})}),$("#infos").on("hidden.bs.modal",function(){com&&(map.removeLayer(com),com=null)});