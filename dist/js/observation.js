function carte(e,t,i){"use strict";var a=t.split(",",2),o=parseFloat(a[0]),s=parseFloat(a[1]);if("oui"==nbmap){nbmap="non",map=new L.map("mapobser");var n=new L.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});map.setView(new L.LatLng(o,s),i),map.addLayer(n),1==e&&(marker=L.marker([o,s]).addTo(map))}else map.setView(new L.LatLng(o,s),i),1==e&&(marker=L.marker([o,s]).addTo(map))}function modfiche(e){"use strict";$.ajax({url:"modeles/ajax/saisie/attribution.php",type:"POST",dataType:"json",data:{idfiche:e},success:function(e){"Oui"==e.statut?document.location.href="index.php?module=saisie&action=saisie":alert("Erreur ! ")}})}function adson(e){"use strict";$.ajax({url:"modeles/ajax/saisie/attribution.php",type:"POST",dataType:"json",data:{idobs:e},success:function(e){"Oui"==e.statut?document.location.href="index.php?module=membre&action=ajoutson":alert("Erreur ! ")}})}function adphoto(e){"use strict";$.ajax({url:"modeles/ajax/saisie/attribution.php",type:"POST",dataType:"json",data:{idobs:e},success:function(e){"Oui"==e.statut?document.location.href="index.php?module=membre&action=ajoutphoto":alert("Erreur ! ")}})}function traitement(e,t){"use strict";var i=$("#perso").is(":checked")?"oui":"non",a=$("#nperso").is(":checked")?"oui":"non",o=$("#sel").val(),s=$("#regroup option:selected").val(),n=$("#tri option:selected").val(),r=$("#dep").val();$.ajax({url:"modeles/ajax/observation/observation.php",type:"POST",dataType:"json",data:{sel:o,regroup:s,tri:n,dep:r,page:e,indice:t,perso:i,nperso:a},success:function(e){"Oui"==e.statut?($("#listeobs").html(e.listeobs),$("#pagination").html(e.pagination),$('[data-toggle="tooltip"]').tooltip(),e.indice?($("#indice").show(),"oui"==e.indice.E?$("#E").show():$("#E").hide(),"oui"==e.indice.TR?$("#TR").show():$("#TR").hide(),"oui"==e.indice.R?$("#R").show():$("#R").hide(),"oui"==e.indice.AR?$("#AR").show():$("#AR").hide(),"oui"==e.indicet?$("#indicet").show():$("#indicet").hide()):$("#indice").hide()):alert("Erreur ! ")}})}var map,marker,nbmap="oui";$(document).ready(function(){"use strict";$("#indice").hide(),traitement(1,0)}),$(".idvar").click(function(){"use strict";$("#listeobs").html('<div class="mt-1"><p class="text-warning text-center"><span class="fa fa-spin fa-spinner fa-2x"></span> Chargement des données...</p></div>');var e=$(this).attr("id");$("#sel").val(e),$(".list-inline").find("li").removeClass("color1"),$(this).addClass("color1"),$(".idind").removeClass("tag-info").addClass("tag-default"),$("#p").val(1),traitement(1,0)}),$("#regroup").change(function(){"use strict";$("#p").val(1),traitement(1,0)}),$("#perso").change(function(){"use strict";$(this).is(":checked")&&$("#nperso").prop("checked",!1),$("#p").val(1),traitement(1,0)}),$("#nperso").change(function(){"use strict";$(this).is(":checked")&&$("#perso").prop("checked",!1),$("#p").val(1),traitement(1,0)}),$("#tri").change(function(){"use strict";"dateobs"==tri?$("#titrep").html("Les dernières observations (30 derniers jours)"):$("#titrep").html("Les dernières observations de saisie"),$("#p").val(1),traitement(1,0)}),$("#fiche").on("show.bs.modal",function(e){"use strict";var t=$(e.relatedTarget),i=t.data("idfiche"),a=$(this);$.ajax({url:"modeles/ajax/observation/infofiche.php",type:"POST",dataType:"json",data:{idfiche:i},success:function(e){"Oui"==e.statut?(a.find(".modal-title").html("Information sur le relevé n° "+i),e.mod?a.find(".lienidobs").html('<a class="color1" target="_blank" href="'+e.lien+'">Plus de détail</a><i class="fa fa-pencil curseurlien ml-3" onclick="modfiche('+i+')" title="Modifier votre relevé"></i>'):a.find(".lienidobs").html('<a class="color1" target="_blank" href="'+e.lien+'">Plus de détail</a>'),a.find("#listefiche").html(e.liste)):alert("erreur")}})}),$("#obs").on("show.bs.modal",function(e){"use strict";var t=$(e.relatedTarget),i=t.data("nomlat"),a=t.data("idobs"),o=t.data("latin"),s=t.data("nomfr"),n=t.data("photo"),r=t.data("idmor"),l=$(this);$.ajax({url:"modeles/ajax/observation/infoobs.php",type:"POST",dataType:"json",data:{idobs:a,photo:n},success:function(e){if("Oui"==e.statut)if(e.diffcdref?l.find(".diffcdref").html("Saisie sous le nom de : <i>"+e.diffcdref+"</i>"):l.find(".diffcdref").html(""),l.find(".obsdatefr").html(e.date),l.find(".obsidobs").html(a),l.find(".obsfloutage").html(e.lieu),l.find(".obsobservateur").html(e.observateur),l.find(".obsdeterminateur").html("Déterminateur : "+e.determinateur),l.find(".obsligne").html(e.ligne),l.find("#idobscom").val(a),l.find("#idmor").val(r),l.find(".lienidobs").html('<a class="color1" target="_blank" href="'+e.lien+'">Plus de détail</a>'),r?$("#postcom").show():$("#postcom").hide(),e.mod?l.find(".modobs").html('<i class="text-warning fa fa-pencil curseurlien ml-3" onclick="modfiche('+e.idfiche+')" title="Modifier votre observation"></i><i class="text-success fa fa-camera curseurlien ml-2" onclick="adphoto('+a+')" title="Ajouter une photo"></i><i class="text-success fa fa-volume-off curseurlien ml-2" onclick="adson('+a+')" title="Ajouter un son"></i>'):e.adphoto?l.find(".modobs").html('<i class="text-success fa fa-camera curseurlien ml-2" onclick="adphoto('+a+')" title="Ajouter une photo"></i><i class="text-success fa fa-volume-off curseurlien ml-2" onclick="adson('+a+')" title="Ajouter un son"></i>'):l.find(".modobs").html(""),e.commentaire?l.find(".obscommentaire").html(e.commentaire):l.find(".obscommentaire").html(""),e.photo?l.find(".obsphoto").html(e.photo):l.find(".obsphoto").html(""),e.coord){var t=e.pre,i=e.coord,o=1==t?14:12;carte(t,i,o),setTimeout(function(){map.invalidateSize()},400)}else{var t=0,o=8,s=$("#lat").val(),n=$("#lng").val(),i=s+","+n;carte(t,i,o),setTimeout(function(){map.invalidateSize()},400)}else alert("erreur")}}),"oui"==o?l.find(".modal-title").html("<i>"+i+"</i>"):l.find(".modal-title").html(s+" <i>"+i+"</i>")}),$("#obs").on("hidden.bs.modal",function(){"use strict";marker&&(map.removeLayer(marker),marker=null)}),$("#BttVcom").click(function(){"use strict";var e=$("#idobscom").val(),t=$("#idmcom").val(),i=$("#idmor").val(),a=$("#commentaire").val();""!=a?$.ajax({url:"modeles/ajax/observation/commentaire.php",type:"POST",dataType:"json",data:{idm:t,idobs:e,com:a,idmor:i},success:function(e){"Oui"!=e.statut&&alert("Erreur ! lors insertion table"),$("#commentaire").val("")}}):alert("Aucun commentaire de saisie !")}),$(".popup-gallery").magnificPopup({delegate:"a",type:"image",tLoading:"Loading image #%curr%...",mainClass:"mfp-img-mobile",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image #%curr%</a> est absente..',titleSrc:function(e){return e.el.attr("title")}}}),$("#bttrhaut").click(function(){"use strict";$("html, body").animate({scrollTop:0},"slow")}),$("#pagination").on("click",".page-item",function(){"use strict";var e=$(this).attr("id"),t=e.substring(0,2);if("pp"==t)var i=e.substring(2);else var i=e.substring(1);$("#p").val(i),$("html, body").animate({scrollTop:0},"slow"),traitement(i,0)}),$(".idind").click(function(){"use strict";$("#listeobs").html('<div class="mt-1"><p class="text-warning text-center"><span class="fa fa-spin fa-spinner fa-2x"></span> Chargement des données...</p></div>');var e=$(this).attr("id");$(".idind").removeClass("tag-info").addClass("tag-default"),$(this).addClass("tag-info").removeClass("tag-default");var t=$("#p").val();"indicet"!=e?traitement(t,e):traitement(t,0)});