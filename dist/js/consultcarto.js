function carte(e){"use strict";proj4.defs("EPSG:2154","+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");var t=e.utm,o=(e.contour2,e.emprise),r=(e.ne,e.sw,e.cleign);e.clegoogle;map=L.map("carte"),$.getJSON("emprise/contour2.geojson",{},function(t){var o={color:e.stylecontour2.color,weight:e.stylecontour2.weight},r=L.Proj.geoJson(t,{style:o}).addTo(map);map.fitBounds(r.getBounds())});var a=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}),i=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}).addTo(map),n=L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; Openstreetmap France | &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),s=L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:16,attribution:'Map data: &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="http://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'});if(r)var l=L.tileLayer("https://wxs.ign.fr/"+r+"/geoportail/wmts?LAYER=GEOGRAPHICALGRIDSYSTEMS.MAPS&EXCEPTIONS=text/xml&FORMAT=image/jpeg&SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetTile&STYLE=normal&TILEMATRIXSET=PM&&TILEMATRIX={z}&TILECOL={x}&TILEROW={y}",{attribution:'&copy; <a href=http://www.ign.fr/">IGN</a>'}),c=L.tileLayer("https://wxs.ign.fr/"+r+"/geoportail/wmts?LAYER=ORTHOIMAGERY.ORTHOPHOTOS&EXCEPTIONS=text/xml&FORMAT=image/jpeg&SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetTile&STYLE=normal&TILEMATRIXSET=PM&&TILEMATRIX={z}&TILECOL={x}&TILEROW={y}",{attribution:'&copy; <a href="http://www.ign.fr/">IGN</a>'}),p=L.tileLayer("https://wxs.ign.fr/"+r+"/geoportail/wmts?LAYER=CADASTRALPARCELS.PARCELS&EXCEPTIONS=text/xml&FORMAT=image/png&SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetTile&STYLE=normal&TILEMATRIXSET=PM&&TILEMATRIX={z}&TILECOL={x}&TILEROW={y}",{opacity:"0.5",attribution:'&copy; <a href="http://www.ign.fr/">IGN</a>'}),u={"Carte Open Street":i,"Carte Open Street FR":n,"Carte Open Topo":s,"Carte IGN":l,"Photo aériennes IGN":c,"Photo aériennes ESRI":a},m={Cadastre:p};else var u={"Carte Open Street":i,"Carte Open Street FR":n,"Carte Open Topo":s,"Photo aériennes ESRI":a},m={};var y=L.control.layers(u,m);"fr"!=o?($.getJSON("emprise/contour.geojson",{},function(t){var o={color:e.stylecontour.color,weight:e.stylecontour.weight},r=L.Proj.geoJson(t,{style:o}),a="Commune";y.addOverlay(r,a)}),"oui"==t?$.getJSON("modeles/ajax/carto/mgrs.php",{},function(t){if("Oui"==t.statut){var o={color:e.stylemaille.color,weight:e.stylemaille.weight,opacity:e.stylemaille.opacity},r=L.Proj.geoJson(t.carto,{style:o,onEachFeature:function(e,t){t.bindPopup(e.properties.id)}}),a="Maille UTM/MGRS";y.addOverlay(r,a)}}):$.getJSON("modeles/ajax/carto/maille93.php",{},function(t){if("Oui"==t.statut){var o={color:e.stylemaille.color,weight:e.stylemaille.weight,fillOpacity:e.stylemaille.opacity},r=L.Proj.geoJson(t.carto,{style:o,onEachFeature:function(e,t){t.bindPopup(e.properties.id)}}),a="MailleL93";y.addOverlay(r,a)}})):($.getJSON("../emprise/contour.geojson",{},function(t){var o={color:e.stylecontour.color,weight:e.stylecontour.weight},r=L.Proj.geoJson(t,{style:o}),a="Départements";y.addOverlay(r,a)}),"oui"==t&&$.getJSON("modeles/ajax/carto/mgrs.php",{},function(t){if("Oui"==t.statut){var o={color:e.stylemaille.color,weight:e.stylemaille.weight,opacity:e.stylemaille.opacity},r=L.Proj.geoJson(t.carto,{style:o,onEachFeature:function(e,t){t.bindPopup(e.properties.id)}}),a="Maille UTM/MGRS";y.addOverlay(r,a)}})),L.control.scale({position:"bottomleft",metric:!0,imperial:!1}).addTo(map),y.addTo(map),map.on("click",function(e){var t=1e3*$("#rayon").val();currentLayer&&map.removeLayer(currentLayer),cercle?(map.removeLayer(cercle),cercle=L.circle(e.latlng,{fillOpacity:.1,radius:t}).addTo(map)):cercle=L.circle(e.latlng,{fillOpacity:.1,radius:t}).addTo(map),map.fitBounds(cercle.getBounds());var o=Math.round(1e4*e.latlng.lat)/1e4,r=Math.round(1e4*e.latlng.lng)/1e4;rechercheobs(t,o,r)})}function rechercheobs(e,t,o){"use strict";var r=$("#sel").val(),a=$("#rayon").val();$.ajax({url:"modeles/ajax/consultation/obscarto.php",type:"POST",dataType:"json",data:{lat:t,lng:o,dist:a,sel:r},success:function(e){"Oui"==e.statut?($("#retourliste").html("<b>"+e.nb+" espèces de trouvée"),affichepoint(e.point)):$("#retourliste").html("<b> Aucune observation pour cette zone ")}})}function generateGeojsonPoint(e){"use strict";return geojsonsite={type:"FeatureCollection",features:[]},e.forEach(function(e){var t=e.geojson_point,o={site:e.site};geojsonsite.features.push({type:"Feature",properties:o,geometry:t})}),geojsonsite}function affichepoint(e){"use strict";var t={radius:5,fillColor:"red",color:"red"};if(geojsonsite=generateGeojsonPoint(e),currentLayer=L.geoJson(geojsonsite,{onEachFeature:onEachFeature,pointToLayer:function(e,o){return L.circleMarker(o,t)}}),geojsonsite.features.length>100){var o=currentLayer;currentLayer=L.markerClusterGroup(),currentLayer.addLayer(o),map.addLayer(currentLayer)}else currentLayer.addTo(map)}function onEachFeature(e,t){"use strict";var o="<b>Site : </b>"+e.properties.site+"<br>lien pour voir obs de ce site à faire";t.bindPopup(o)}var map,cercle,currentLayer,geojsonsite;$(document).ready(function(){"use strict";var e={};$.ajax({url:"emprise/emprise.json",dataType:"json",success:function(t){e=t,carte(e)}}),$("#carte").css("cursor","crosshair")}),$(".idvar").click(function(){"use strict";var e=$(this).attr("id");$(".list-inline").find("li").removeClass("color1"),$(this).addClass("color1"),$("#sel").val(e)});